version: "3.8"

networks:
  default: 
    name: ${DEFAULT_NETWORK_NAME:-booxit-backend-network}

services:
  php:
    hostname: ${PHP_CONTAINER_HOSTNAME:-booxit-backend-php}
    build:
      context: ./docker/php
      target: app_base
    restart: unless-stopped
    volumes:
      - ./:/var/www
    environment:
      DATABASE_URL: ${DATABASE_URL}
    networks:
      - default

  caddy:
    hostname: ${CADDY_CONTAINER_HOSTNAME:-booxit-backend-caddy}
    image: caddy:2.8-alpine
    depends_on:
      - php
    restart: unless-stopped
    volumes:
      - ./docker/caddy/Caddyfile:/etc/caddy/Caddyfile
      - ./public:/var/www/public
    networks:
      - default

  database:
    hostname: ${DB_CONTAINER_HOSTNAME:-booxit-backend-db}
    image: postgres:${POSTGRES_VERSION:-15}-alpine
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-app}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-!ChangeMe!}
      POSTGRES_USER: ${POSTGRES_USER:-app}
    volumes:
      - ./docker/db/data:/var/lib/postgresql/data:rw
    networks:
      - default
